<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.5.2 -->
    <script>
        window.materialVersion = "1.5.2"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1',
            '1.5.0'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">



    <link rel="dns-prefetch" href="https://busuanzi.ibruce.info">












    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!-- Title -->
    
    <title>
        
            加密数字货币和传统分布式系统共识机制 | 
        
        区块链技术指北 | ChainONE 官方博客
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.ico">
    <link rel="icon" href="/img/favicon.ico">

    <meta name="format-detection" content="telephone=no">
    <meta name="description" itemprop="description" content="现有的银行体系是一个中心化的系统，中心化的系统具有绝对的权威，人们信赖银行，相信银行是安全的，也相信银行是不会做假账的。银行是共识，法币也是共识，换句话说，具有等价交换的介质都有共识。由于加密货币多数采用去中心化的区块链设计，节点是各处分散且平行的，所以必须设计一套制度，来维护系统的运作顺序与公平性，统一区块链的版本，并奖励提供资源维护区块链的使用者，以及惩罚恶意的危害者。这样的制度，必须依赖某种方式来证明，是由谁取得了一个区块链的打包权（或称记账权），并且可以获取打包这一个区块的奖励；又或者是谁意图进行危害，就会获得一定的惩罚，这就是共识机制。本文从传统银行共识概念出发，阐述了分布式系统为什么需要共识机制。接着引出了分布式系统的的基本理论，然后阐述了加密数字货币的共识算法，最后给出了传统分布式系统里的共识算法。共识算法也是一个 Trade-off 的机制。">
    <meta name="keywords" content="区块链, ChainONE,Blockchain,Consensus">
    <meta name="theme-color" content="#0097A7">

    <!-- Disable Fucking Bloody Baidu Tranformation -->
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta http-equiv="Cache-Control" content="no-siteapp">

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(a){try{localStorage.removeItem(a)}catch(b){}};lsloader.setLS=function(a,c){try{localStorage.setItem(a,c)}catch(b){}};lsloader.getLS=function(a){var c="";try{c=localStorage.getItem(a)}catch(b){c=""}return c};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var b=[];for(var a=0;a<localStorage.length;a++){b.push(localStorage.key(a))}b.forEach(function(e){var f=lsloader.getLS(e);if(window.oldVersion){var d=window.oldVersion.reduce(function(g,h){return g||f.indexOf("/*"+h+"*/")!==-1},false);if(d){lsloader.removeLS(e)}}})}catch(c){}};lsloader.clean();lsloader.load=function(f,a,b,d){if(typeof b==="boolean"){d=b;b=undefined}d=d||false;b=b||function(){};var e;e=this.getLS(f);if(e&&e.indexOf(versionString)===-1){this.removeLS(f);this.requestResource(f,a,b,d);return}if(e){var c=e.split(versionString)[0];if(c!=a){console.log("reload:"+a);this.removeLS(f);this.requestResource(f,a,b,d);return}e=e.split(versionString)[1];if(d){this.jsRunSequence.push({name:f,code:e});this.runjs(a,f,e)}else{document.getElementById(f).appendChild(document.createTextNode(e));b()}}else{this.requestResource(f,a,b,d)}};lsloader.requestResource=function(b,e,a,c){var d=this;if(c){this.iojs(e,b,function(h,f,g){d.setLS(f,h+versionString+g);d.runjs(h,f,g)})}else{this.iocss(e,b,function(f){document.getElementById(b).appendChild(document.createTextNode(f));d.setLS(b,e+versionString+f)},a)}};lsloader.iojs=function(d,b,g){var a=this;a.jsRunSequence.push({name:b,code:""});try{var f=new XMLHttpRequest();f.open("get",d,true);f.onreadystatechange=function(){if(f.readyState==4){if((f.status>=200&&f.status<300)||f.status==304){if(f.response!=""){g(d,b,f.response);return}}a.jsfallback(d,b)}};f.send(null)}catch(c){a.jsfallback(d,b)}};lsloader.iocss=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.iofonts=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.runjs=function(f,c,e){if(!!c&&!!e){for(var b in this.jsRunSequence){if(this.jsRunSequence[b].name==c){this.jsRunSequence[b].code=e}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var a=document.createElement("script");a.appendChild(document.createTextNode(this.jsRunSequence[0].code));a.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(a);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else{if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var d=this;var a=document.createElement("script");a.src=this.jsRunSequence[0].path;a.type="text/javascript";this.jsRunSequence[0].status="loading";a.onload=function(){d.jsRunSequence.shift();if(d.jsRunSequence.length>0){d.runjs()}};document.body.appendChild(a)}}};lsloader.tagLoad=function(b,a){this.jsRunSequence.push({name:a,code:"",path:b,status:"failed"});this.runjs()};lsloader.jsfallback=function(c,b){if(!!this.jsnamemap[b]){return}else{this.jsnamemap[b]=b}for(var a in this.jsRunSequence){if(this.jsRunSequence[a].name==b){this.jsRunSequence[a].code="";this.jsRunSequence[a].status="failed";this.jsRunSequence[a].path=c}}this.runjs()};lsloader.cssfallback=function(e,c,b){if(!!this.cssnamemap[c]){return}else{this.cssnamemap[c]=1}var d=document.createElement("link");d.type="text/css";d.href=e;d.rel="stylesheet";d.onload=d.onerror=b;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(d,a)};lsloader.runInlineScript=function(c,b){var a=document.getElementById(b).innerText;this.jsRunSequence.push({name:c,code:a});this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Import CSS -->
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","/css/material.min.css?Z7a72R1E4SxzBKR/WGctOA==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","/css/style.min.css?MKetZV3cUTfDxvMffaOezg==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        

    

    

    <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->
<!-- Import Roboto -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">


<!-- Import Material Icons -->


    <style id="material_icons"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_icons","/css/material-icons.css?pqhB/Rd/ab0H2+kZp0RDmw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>




    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","/js/jquery.min.js?qcusAULNeBksqffqUM2+Ig==", true)</script>
    

    <!-- WebAPP Icons -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="区块链技术指北 | ChainONE 官方博客">
    <meta name="msapplication-starturl" content="https://blog.chainon.io/2017/12/27/blockchain-consensus/">
    <meta name="msapplication-navbutton-color" content="#0097A7">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="区块链技术指北 | ChainONE 官方博客">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="/img/favicon.ico">

    <!-- Site Verification -->
    
    

    <!-- RSS -->
    
        
            <link rel="alternate" type="application/atom+xml" href="atom.xml">
        
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="https://blog.chainon.io/2017/12/27/blockchain-consensus/">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="加密数字货币和传统分布式系统共识机制 | 区块链技术指北 | ChainONE 官方博客">
    <meta property="og:image" content="/img/favicon.ico">
    <meta property="og:description" content="现有的银行体系是一个中心化的系统，中心化的系统具有绝对的权威，人们信赖银行，相信银行是安全的，也相信银行是不会做假账的。银行是共识，法币也是共识，换句话说，具有等价交换的介质都有共识。由于加密货币多数采用去中心化的区块链设计，节点是各处分散且平行的，所以必须设计一套制度，来维护系统的运作顺序与公平性，统一区块链的版本，并奖励提供资源维护区块链的使用者，以及惩罚恶意的危害者。这样的制度，必须依赖某种方式来证明，是由谁取得了一个区块链的打包权（或称记账权），并且可以获取打包这一个区块的奖励；又或者是谁意图进行危害，就会获得一定的惩罚，这就是共识机制。本文从传统银行共识概念出发，阐述了分布式系统为什么需要共识机制。接着引出了分布式系统的的基本理论，然后阐述了加密数字货币的共识算法，最后给出了传统分布式系统里的共识算法。共识算法也是一个 Trade-off 的机制。">
    <meta property="og:article:tag" content="Blockchain"> <meta property="og:article:tag" content="Consensus"> 

    
        <meta property="article:published_time" content="Wed Dec 27 2017 22:22:22 GMT+0800">
        <meta property="article:modified_time" content="Sun Jan 31 2021 14:02:47 GMT+0800">
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:card" content="summary_large_image">

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="https://blog.chainon.io/2017/12/27/blockchain-consensus/index.html">
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "https://blog.chainon.io/2017/12/27/blockchain-consensus/index.html",
    "headline": "加密数字货币和传统分布式系统共识机制",
    "datePublished": "Wed Dec 27 2017 22:22:22 GMT+0800",
    "dateModified": "Sun Jan 31 2021 14:02:47 GMT+0800",
    "author": {
        "@type": "Person",
        "name": "ChainONE",
        "image": {
            "@type": "ImageObject",
            "url": "/img/avatar.jpg"
        },
        "description": "Empower Blockchain."
    },
    "publisher": {
        "@type": "Organization",
        "name": "区块链技术指北 | ChainONE 官方博客",
        "logo": {
            "@type":"ImageObject",
            "url": "/img/favicon.ico"
        }
    },
    "keywords": ",Blockchain,Consensus区块链, ChainONE",
    "description": "现有的银行体系是一个中心化的系统，中心化的系统具有绝对的权威，人们信赖银行，相信银行是安全的，也相信银行是不会做假账的。银行是共识，法币也是共识，换句话说，具有等价交换的介质都有共识。由于加密货币多数采用去中心化的区块链设计，节点是各处分散且平行的，所以必须设计一套制度，来维护系统的运作顺序与公平性，统一区块链的版本，并奖励提供资源维护区块链的使用者，以及惩罚恶意的危害者。这样的制度，必须依赖某种方式来证明，是由谁取得了一个区块链的打包权（或称记账权），并且可以获取打包这一个区块的奖励；又或者是谁意图进行危害，就会获得一定的惩罚，这就是共识机制。本文从传统银行共识概念出发，阐述了分布式系统为什么需要共识机制。接着引出了分布式系统的的基本理论，然后阐述了加密数字货币的共识算法，最后给出了传统分布式系统里的共识算法。共识算法也是一个 Trade-off 的机制。",
}
</script>


    

    <!-- Analytics -->
    
        <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-57297247-2', 'auto');ga('send', 'pageview');
</script>
    
    
    

    <!-- Custom Head -->
    

</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span id="MD-burger-id" class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x00-共识机制"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 共识机制</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x01-基本理论"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 基本理论</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-1-一致性-consensus"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">1.1 一致性 (consensus)</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-2-2PC"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">1.2 2PC</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-3-3PC"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">1.3 3PC</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-4-CAP"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">1.4 CAP</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-5-选举-electioin"><span class="post-toc-number">2.5.</span> <span class="post-toc-text">1.5 选举 (electioin)</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-6-多数派-quorum"><span class="post-toc-number">2.6.</span> <span class="post-toc-text">1.6 多数派 (quorum)</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-7-租约-lease"><span class="post-toc-number">2.7.</span> <span class="post-toc-text">1.7 租约 (lease)</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x02-拜占庭将军问题"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x02 拜占庭将军问题</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x03-加密数字货币共识算法"><span class="post-toc-number">4.</span> <span class="post-toc-text">0x03 加密数字货币共识算法</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-1-PoW：Proof-of-Work，工作量证明"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">3.1 PoW：Proof of Work，工作量证明</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-2-PoS：Proof-of-Stake，权益证明"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">3.2 PoS：Proof of Stake，权益证明</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-3-DPoS：Delegated-Proof-of-Stake，委托权益证明"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">3.3 DPoS：Delegated Proof of Stake，委托权益证明</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-4-PBFT：Practical-Byzantine-Fault-Tolerance，实用拜占庭容错算法"><span class="post-toc-number">4.4.</span> <span class="post-toc-text">3.4 PBFT：Practical Byzantine Fault Tolerance，实用拜占庭容错算法</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-5-PoC：Proof-of-Capacity，容量证明"><span class="post-toc-number">4.5.</span> <span class="post-toc-text">3.5 PoC：Proof-of-Capacity，容量证明</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-6-PoA：Proof-of-activity，活动证明"><span class="post-toc-number">4.6.</span> <span class="post-toc-text">3.6 PoA：Proof of activity，活动证明</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-7-PoB：Proof-of-burn，销毁证明"><span class="post-toc-number">4.7.</span> <span class="post-toc-text">3.7 PoB：Proof of burn，销毁证明</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-8-PoET：Proof-of-elapsed-time，运行时间证明"><span class="post-toc-number">4.8.</span> <span class="post-toc-text">3.8 PoET：Proof of elapsed time，运行时间证明</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-9-Casper：Ethereum-提出"><span class="post-toc-number">4.9.</span> <span class="post-toc-text">3.9 Casper：Ethereum 提出</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x04-传统分布式系统共识算法"><span class="post-toc-number">5.</span> <span class="post-toc-text">0x04 传统分布式系统共识算法</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-1-Paxos"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">4.1 Paxos</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-2-Raft"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">4.2 Raft</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-3-Zab"><span class="post-toc-number">5.3.</span> <span class="post-toc-text">4.3 Zab</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-4-对比"><span class="post-toc-number">5.4.</span> <span class="post-toc-text">4.4 对比</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x05-小结"><span class="post-toc-number">6.</span> <span class="post-toc-text">0x05 小结</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x06-参考"><span class="post-toc-number">7.</span> <span class="post-toc-text">0x06 参考</span></a></li></ol>
    </ul>
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script type="text/ls-javascript" id="post-thumbnail-script">
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                加密数字货币和传统分布式系统共识机制
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.jpg" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>ChainONE</strong>
        <span>12月 27, 2017</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    
        <button id="article-functions-qrcode-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">devices other</i>
    <span class="visuallyhidden">devices other</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-qrcode-button">
    <li class="mdl-menu__item">在其它设备中阅读本文章</li>
    
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPYAAAD2CAAAAADAeSUUAAAC3klEQVR42u3aO7LbMBAEQN7/0nbqwOKbWdAuCmhEKokfNJIVdnD9OnJc2NjY2NjY2NjY2K9kX/H4dNef33x65sep3P766crhnLGxsbG3ZuevvH9x8mvyzOTKes7Y2NjYB7DvGfeTa0vXpycnv7ZzxsbGxsa+f1y+kWiR94uLjY2Njb1ewPLNxsqm5XV1GxsbG/vF7FlrPl+aNh7I20z/vJeGjY2N/Xp2Hpq+5/N/zbexsbGxX8xeaQ/lx3Rmd620sf7yHGxsbOxN2bOGUR7T5ocv2/fm12NjY2PvzV45QLN+/f33PzSJyoXGxsbGPof9VCGZHQBKMLPAGBsbG3tvdj6tfIHye9ugd7h82NjY2Juyk6kngKTk5He1T34s38bGxsbegp2XnySOnYGTuLcNgLGxsbH3ZretolnQ+9SGZxgwYGNjY2/KbieRH8dpW0Vticq3K9jY2Nh7s9uodaWtfy2MtigOtyLY2NjYX85uD+sk7OTKpEAmba8f5oyNjY29Kbt95VMTyiPkunm0sgPDxsbG/kJ2cVt8mGYlQmhLXXI9NjY29t7s9e1E/rT2jbPDl1FTCRsbG3tr9vohmxyTH/3Mm1PY2NjYp7HbUHaGnMUM60uJjY2NfQI72RgkxaZt9+fRQhswYGNjY5/GnkW8bdMn3/bMAuAoisDGxsbemt2GAVc82gXNm1Z19IuNjY29Nbv907+0Jbj9ZlYykxKIjY2NfQ67bdPPDtzMwoNkuYcFDBsbG3sLdjutvJ2UT/daHku9NGxsbOwvZLejLTwteGWZigKGjY2NvRG7LQxt4ykvacnhntm92NjY2Cew83bSbJlmTauVAoaNjY19JrstHnlTqY0TnmokYWNjY2MnLZ6nSlqyZLMtCjY2Njb2yue8mOXxwyy6wMbGxj6Bnbd7HtsexNe3z8fGxsY+jb10qDEoNnlJa8OAIpzGxsbG3pR9zsDGxsbGxsbGxsZ+zfgNxUnDpsy4ZRYAAAAASUVORK5CYII=">
    
</ul>

    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/Blockchain/">Blockchain</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/Consensus/">Consensus</a>
    </ul>
    

    <!-- Share -->
    
        <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    
        
            <!-- Busuanzi Views -->
            <a class="post_share-link" href="#">
                <li class="mdl-menu__item">
                    <span id="busuanzi_container_page_pv">
                        <span id="busuanzi_value_page_pv"></span>&nbsp;浏览量
                    </span>
                </li>
            </a>
        
    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=加密数字货币和传统分布式系统共识机制&url=https://blog.chainon.io/2017/12/27/blockchain-consensus/index.html&pic=https://blog.chainon.io/img/favicon.ico&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=加密数字货币和传统分布式系统共识机制&url=https://blog.chainon.io/2017/12/27/blockchain-consensus/index.html&via=ChainONE" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.chainon.io/2017/12/27/blockchain-consensus/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=https://blog.chainon.io/2017/12/27/blockchain-consensus/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    
        <a class="post_share-link" href="https://www.linkedin.com/shareArticle?mini=true&url=https://blog.chainon.io/2017/12/27/blockchain-consensus/index.html&title=加密数字货币和传统分布式系统共识机制" target="_blank">
            <li class="mdl-menu__item">
                分享到 LinkedIn
            </li>
        </a>
    

    <!-- Share QQ -->
    
        <a class="post_share-link" href="http://connect.qq.com/widget/shareqq/index.html?site=区块链技术指北 | ChainONE 官方博客&title=加密数字货币和传统分布式系统共识机制&summary=ChainONE, Empower Blockchain. 区块链技术指北，构建优质社区，传播和分享区块链技术，探讨潜在价值，连接技术和商业。&pics=https://blog.chainon.io/img/favicon.ico&url=https://blog.chainon.io/2017/12/27/blockchain-consensus/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 QQ
            </li>
        </a>
    

    <!-- Share Telegram -->
    
        <a class="post_share-link" href="https://telegram.me/share/url?url=https://blog.chainon.io/2017/12/27/blockchain-consensus/index.html&text=加密数字货币和传统分布式系统共识机制" target="_blank">
            <li class="mdl-menu__item">
                分享到 Telegram
            </li>
        </a>
    
</ul>

    
</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <p>现有的银行体系是一个中心化的系统，中心化的系统具有绝对的权威，人们信赖银行，相信银行是安全的，也相信银行是不会做假账的。银行是共识，法币也是共识，换句话说，具有等价交换的介质都有共识。由于加密货币多数采用去中心化的区块链设计，节点是各处分散且平行的，所以必须设计一套制度，来维护系统的运作顺序与公平性，统一区块链的版本，并奖励提供资源维护区块链的使用者，以及惩罚恶意的危害者。这样的制度，必须依赖某种方式来证明，是由谁取得了一个区块链的打包权（或称记账权），并且可以获取打包这一个区块的奖励；又或者是谁意图进行危害，就会获得一定的惩罚，这就是共识机制。本文从传统银行共识概念出发，阐述了分布式系统为什么需要共识机制。接着引出了分布式系统的的基本理论，然后阐述了加密数字货币的共识算法，最后给出了传统分布式系统里的共识算法。共识算法也是一个 Trade-off 的机制。<br><a id="more"></a></p>
<p><code>文/温国兵</code></p>
<blockquote>
<p>本文由币乎社区（bihu.com）内容支持计划奖励。</p>
</blockquote>
<p>这是「区块链技术指北」的第 13 篇文章。</p>
<blockquote>
<p>如果对我感兴趣，想和我交流，我的微信号：<strong>Wentasy</strong>，加我时简单介绍下自己，并注明来自「区块链技术指北」。同时我会把你拉入微信群「区块链技术指北」。BTW，李笑来老师也加入了我的知识星球，文末有加入方式。</p>
</blockquote>
<h2 id="0x00-共识机制"><a href="#0x00-共识机制" class="headerlink" title="0x00 共识机制"></a>0x00 共识机制</h2><hr>
<p>现有的银行体系是一个中心化的系统，中心化的系统具有绝对的权威，人们信赖银行，相信银行是安全的，也相信银行是不会做假账的。银行是共识，法币也是共识，换句话说，具有等价交换的介质都有共识。</p>
<p>由于加密货币多数采用去中心化的区块链设计，节点是各处分散且平行的，所以必须设计一套制度，来维护系统的运作顺序与公平性，统一区块链的版本，并奖励提供资源维护区块链的使用者，以及惩罚恶意的危害者。这样的制度，必须依赖某种方式来证明，是由谁取得了一个区块链的打包权（或称记账权），并且可以获取打包这一个区块的奖励；又或者是谁意图进行危害，就会获得一定的惩罚，这就是加密数字货币的 <strong>共识机制</strong>。[1]</p>
<p><img src="https://i.imgur.com/0pFDjEc.jpg" alt="2017-12-27-blockchain-consensus"></p>
<blockquote>
<p>题图来自: © Cliff Küle / How Blockchain Technology &amp; Gold Can Work Together / cliffkule.com</p>
</blockquote>
<h2 id="0x01-基本理论"><a href="#0x01-基本理论" class="headerlink" title="0x01 基本理论"></a>0x01 基本理论</h2><hr>
<h3 id="1-1-一致性-consensus"><a href="#1-1-一致性-consensus" class="headerlink" title="1.1 一致性 (consensus)"></a>1.1 一致性 (consensus)</h3><hr>
<p>何为一致性问题？简单而言，一致性问题就是相互独立的节点之间如何达成一项决议的问题。分布式系统中，进行数据库事务提交 (commit transaction)、Leader 选举、序列号生成等都会遇到一致性问题。[2]</p>
<p>假设一个具有 N 个节点的分布式系统，当其满足以下条件时，我们说这个系统满足一致性：</p>
<ul>
<li>全认同 (agreement): 所有 N 个节点都认同一个结果</li>
<li>值合法 (validity): 该结果必须由 N 个节点中的节点提出</li>
<li>可结束 (termination): 决议过程在一定时间内结束，不会无休止地进行下去</li>
</ul>
<p>分布式系统实现起来并不轻松，因为它面临着这些问题：</p>
<ul>
<li>消息传递异步无序 (asynchronous): 现实网络不是一个可靠的信道，存在消息延时、丢失，节点间消息传递做不到同步有序 (synchronous)</li>
<li>节点宕机 (fail-stop): 节点持续宕机，不会恢复</li>
<li>节点宕机恢复 (fail-recover): 节点宕机一段时间后恢复，在分布式系统中最常见</li>
<li>网络分化 (network partition): 网络链路出现问题，将 N 个节点隔离成多个部分</li>
<li>拜占庭将军问题 (byzantine failure): 节点或宕机或逻辑失败，甚至不按套路出牌抛出干扰决议的信息</li>
</ul>
<p>一致性还具备两个属性，一个是强一致 (safety)，它要求所有节点状态一致、共进退；一个是可用 (liveness)，它要求分布式系统 24*7 无间断对外服务。<strong>FLP 定理 (FLP impossibility)</strong> 已经证明在一个收窄的模型中 (异步环境并只存在节点宕机)，不能同时满足 safety 和 liveness。</p>
<h3 id="1-2-2PC"><a href="#1-2-2PC" class="headerlink" title="1.2 2PC"></a>1.2 2PC</h3><hr>
<p>2PC(tow phase commit) <strong>两阶段提交</strong>，顾名思义它分成两个阶段，先由一方进行提议 (propose) 并收集其他节点的反馈 (vote)，再根据反馈决定提交 (commit) 或中止 (abort) 事务。我们将提议的节点称为协调者 (coordinator)，其他参与决议节点称为参与者 (participants, 或 cohorts)。</p>
<h3 id="1-3-3PC"><a href="#1-3-3PC" class="headerlink" title="1.3 3PC"></a>1.3 3PC</h3><hr>
<p>3PC(three phase commit) 即 <strong>三阶段提交</strong>。</p>
<p>在 2PC 中一个 participant 的状态只有它自己和 coordinator 知晓，假如 coordinator 提议后自身宕机，在 watchdog 启用前一个 participant 又宕机，其他 participant 就会进入既不能回滚、又不能强制 commit 的阻塞状态，直到 participant 宕机恢复。这引出两个疑问：</p>
<ul>
<li>能不能去掉阻塞，使系统可以在 commit/abort 前回滚 (rollback) 到决议发起前的初始状态</li>
<li>当次决议中，participant 间能不能相互知道对方的状态，又或者 participant 间根本不依赖对方的状态</li>
</ul>
<p>相比 2PC，3PC 增加了一个准备提交 (prepare to commit) 阶段来解决以上问题。</p>
<h3 id="1-4-CAP"><a href="#1-4-CAP" class="headerlink" title="1.4 CAP"></a>1.4 CAP</h3><hr>
<p>CAP 由 Eric Brewer 在 2000 年 PODC 会议上提出，是 Eric Brewer 在 Inktomi[3] 期间研发搜索引擎、分布式 web 缓存时得出的关于数据一致性 (consistency)、服务可用性 (availability)、分区容错性 (partition-tolerance) 的猜想：</p>
<blockquote>
<p>It is impossible for a web service to provide the three following guarantees : Consistency, Availability and Partition-tolerance.</p>
</blockquote>
<p>该猜想在提出两年后被证明成立，成为我们熟知的 <strong>CAP 定理</strong>：</p>
<ul>
<li>数据一致性 (consistency)：如果系统对一个写操作返回成功，那么之后的读请求都必须读到这个新数据；如果返回失败，那么所有读操作都不能读到这个数据，对调用者而言数据具有强一致性 (strong consistency) (又叫原子性 atomic、线性一致性 linearizable consistency)</li>
<li>服务可用性 (availability)：所有读写请求在一定时间内得到响应，可终止、不会一直等待</li>
<li>分区容错性 (partition-tolerance)：在网络分区的情况下，被分隔的节点仍能正常对外服务</li>
</ul>
<p>在某时刻如果满足 AP，分隔的节点同时对外服务但不能相互通信，将导致状态不一致，即不能满足 C；如果满足 CP，网络分区的情况下为达成 C，请求只能一直等待，即不满足 A；如果要满足 CA，在一定时间内要达到节点状态一致，要求不能出现网络分区，则不能满足 P。</p>
<p>C、A、P 三者最多只能满足其中两个，和 FLP 定理一样，CAP 定理也指示了一个不可达的结果 (impossibility result)。[3]</p>
<h3 id="1-5-选举-electioin"><a href="#1-5-选举-electioin" class="headerlink" title="1.5 选举 (electioin)"></a>1.5 选举 (electioin)</h3><hr>
<p>一致性问题 (consistency) 是独立的节点间如何达成决议的问题，选出大家都认可的 leader 本质上也是一致性问题，因而如何应对宕机恢复、网络分化等在 leader 选举中也需要考量。[4]</p>
<p>比如 MHA 在主节点故障时会根据配置文件的配置来决定谁来当选新的主节点，如果想要某个节点作为备用的主节点，可以设置 <strong>candidate_master = 1</strong>。如果不希望这个节点被选举为主节点，设置 <strong>no_master = 1</strong>。</p>
<p>再比如 Redis Sentinel 集群里，也会根据 Redis 从节点的 <strong>slave-priority</strong> 配置来决定选举优先级。</p>
<h3 id="1-6-多数派-quorum"><a href="#1-6-多数派-quorum" class="headerlink" title="1.6 多数派 (quorum)"></a>1.6 多数派 (quorum)</h3><hr>
<p>在网络分化的场景下以上 Bully 算法会遇到一个问题，被分隔的节点都认为自己具有最大的序号、将产生多个 leader，这时候就需要引入多数派 (quorum)。多数派的思路在分布式系统中很常见，其确保网络分化情况下决议唯一。</p>
<p>多数派的原理说起来很简单，假如节点总数为 2f+1，则一项决议得到多于 f 节点赞成则获得通过。leader 选举中，网络分化场景下只有具备多数派节点的部分才可能选出 leader，这避免了多 leader 的产生。</p>
<p>比如 Redis Sentinel 集群里，假如有 5 个节点，quorum 设置为 4，也就是说有大于等于 4 个 Sentinel 节点确认某个 Redis Master 出现 SDOWN，那么 Redis Maser 进入 ODOWN 的状态。</p>
<p>SDOWM 表示 Objectively Down，单个 Sentinel 节点在 down-after-milliseconds 时间内没有收到 Redis masterping 的有效回复，这个 Redis Master 进入 SDOWN 主观下线状态。</p>
<p>ODOWN 表示 Objectively Down，接收多个（&gt;=quorum) Sentinel 节点的 SDOWN 的确认，这个 Redis Master 进入 O_DOWN 客观下线状态。O_DOWN 将会触发 Sentinel leader 执行 Failover。Failover 操作会切换到优先级较高的从节点，然后保证业务的高可用。</p>
<h3 id="1-7-租约-lease"><a href="#1-7-租约-lease" class="headerlink" title="1.7 租约 (lease)"></a>1.7 租约 (lease)</h3><hr>
<p>选举中很重要的一个问题，以上尚未提到：怎么判断 leader 不可用、什么时候应该发起重新选举？最先可能想到会通过心跳 (heart beat) 判别 leader 状态是否正常，但在网络拥塞或瞬断的情况下，这容易导致出现双主。</p>
<p>租约 (lease) 是解决该问题的常用方法，其最初提出时用于解决分布式缓存一致性问题，后面在分布式锁等很多方面都有应用。</p>
<h2 id="0x02-拜占庭将军问题"><a href="#0x02-拜占庭将军问题" class="headerlink" title="0x02 拜占庭将军问题"></a>0x02 拜占庭将军问题</h2><hr>
<p>区块链是一个分布式系统。李笑来老师的 <a href="https://github.com/xiaolai/INB-Principles" target="_blank" rel="noopener">INB Principles</a> 里提到几条原则：[5]</p>
<ul>
<li>这世界真的需要这东西吗？</li>
<li>它解决了什么原本没有被解决的问题？</li>
<li>去中心化在这件事儿上真的必要吗？</li>
<li>它真的必须账务公开吗？</li>
<li>账务公开的存在真的会提高它的效率吗？</li>
<li>它在多大程度上更接近一个 DAC (Decentralized autonomous corporation， 去中心化自治公司)？</li>
<li>如果我们决定投资，那么我们应该用我们资金的多大比例去投资？</li>
</ul>
<p>数据库里也有分布式数据库。分布式数据库的基本特点包括：物理分布性、逻辑整体性和站点自治性。从这三个基本特点还可以导出的其它特点有：数据分布透明性、按既定协议达成共识的机制、适当的数据冗余度和事务管理的分布性。一个分布式系统一定会有共识机制，随之而来的就是 <strong>拜占庭将军问题</strong>。</p>
<p>我们来看看维基百科是怎么解释这个问题的。[6]</p>
<blockquote>
<p>一组拜占庭将军分别各率领一支军队共同围困一座城市。为了简化问题，将各支军队的行动策略限定为进攻或撤离两种。因为部分军队进攻部分军队撤离可能会造成灾难性后果，因此各位将军必须通过投票来达成一致策略，即所有军队一起进攻或所有军队一起撤离。因为各位将军分处城市不同方向，他们只能通过信使互相联系。在投票过程中每位将军都将自己投票给进攻还是撤退的信息通过信使分别通知其他所有将军，这样一来每位将军根据自己的投票和其他所有将军送来的信息就可以知道共同的投票结果而决定行动策略。</p>
</blockquote>
<p>系统的问题在于，将军中可能出现叛徒，他们不仅可能向较为糟糕的策略投票，还可能选择性地发送投票信息。假设有 9 位将军投票，其中 1 名叛徒。8 名忠诚的将军中出现了 4 人投进攻，4 人投撤离的情况。这时候叛徒可能故意给 4 名投进攻的将领送信表示投票进攻，而给 4 名投撤离的将领送信表示投撤离。这样一来在 4 名投进攻的将领看来，投票结果是 5 人投进攻，从而发起进攻；而在 4 名投撤离的将军看来则是 5 人投撤离。这样各支军队的一致协同就遭到了破坏。</p>
<p>由于将军之间需要通过信使通讯，叛变将军可能通过伪造信件来以其他将军的身份发送假投票。而即使在保证所有将军忠诚的情况下，也不能排除信使被敌人截杀，甚至被敌人间谍替换等情况。因此很难通过保证人员可靠性及通讯可靠性来解决问题。</p>
<p>上述的故事映射到计算机系统里，将军便成了计算机，而信差就是通信系统。再映射到区块链技术里，每个节点便是将军，而这个通信系统就是共识机制。而共识机制究竟是什么，它是计算机里的算法，由算法来保证这个共识机制。</p>
<h2 id="0x03-加密数字货币共识算法"><a href="#0x03-加密数字货币共识算法" class="headerlink" title="0x03 加密数字货币共识算法"></a>0x03 加密数字货币共识算法</h2><hr>
<p>加密数字货币主流的共识算法有：</p>
<ul>
<li>PoW：Proof of Work，工作量证明</li>
<li>PoS：Proof of Stake，权益证明</li>
<li>DPoS：Delegated Proof of Stake，委托权益证明</li>
<li>PBFT：Practical Byzantine Fault Tolerance，实用拜占庭容错算法</li>
<li>PoSpace/PoC：Proof-of-space/Proof-of-Capacity，容量证明</li>
<li>PoA：Proof of activity，活动证明</li>
<li>PoB：Proof of burn，销毁证明</li>
<li>PoET：Proof of elapsed time，运行时间证明</li>
<li>Casper：Ethereum 提出</li>
</ul>
<p>我们一起来了解这些算法是什么，以及这些算法有什么优劣。</p>
<h3 id="3-1-PoW：Proof-of-Work，工作量证明"><a href="#3-1-PoW：Proof-of-Work，工作量证明" class="headerlink" title="3.1 PoW：Proof of Work，工作量证明"></a>3.1 PoW：Proof of Work，工作量证明</h3><hr>
<p>工作量证明（Proof-of-Work，PoW）是一种对应服务与资源滥用、或是阻断服务攻击的经济对策。一般是要求用户进行一些耗时适当的复杂运算，并且答案能被服务方快速验算，以此耗用的时间、设备与能源做为担保成本，以确保服务与资源是被真正的需求所使用。PoW 原理是由各节点以算力解题的方式来竞争当前区块的写入权，最快解得答案者将答案与他自己选择好的交易内容（也就是当前区块内容）发布给其它节点验证，若其它节点验证区块内容正确且同意他是最早解题者，则加入此链并将此区块内容储存起来，并以此区块内容作为依据开始解下个题目。[7]</p>
<p><strong>POW 的优点有：</strong><br>(1) 为最安全的公有链共识机制，比特币采用的是此共识算法<br>(2) 机制较简单容易实行<br>(3) 相对公平的挖矿机制（也就是加密货币的产生与分配）</p>
<p><strong>POW 的缺点为：</strong><br>(1) 消耗大量能源，算力是以能源消耗为代价制造出来的，比如现在的矿机挖矿需要消耗巨大的电力<br>(2) 区块的确认时间较难缩短，比特币网络拥堵问题日益严重<br>(3) 可能产生分叉，需要等待多个确认才能完成交易<br>(4) 基于（3），理论上我们可说 POW 没有最终性，因为永远可能出现更长链来取代当前帐本，但实际上六个确认后其机率已趋近于 0</p>
<p><strong>使用 POW 共识算法的数字货币，代表的有 BTC、LTC、ETH 等。</strong></p>
<h3 id="3-2-PoS：Proof-of-Stake，权益证明"><a href="#3-2-PoS：Proof-of-Stake，权益证明" class="headerlink" title="3.2 PoS：Proof of Stake，权益证明"></a>3.2 PoS：Proof of Stake，权益证明</h3><hr>
<p>POS 即拥有越多加密货币（权益）的锻工越容易拿到当前区块的写入权（挖到矿）。它与 POW 不同，不需要消耗大量的算力，因为没有算力竞争的需求。原始版本的 POS 在创世初期就已产生出所有的货币，意即新的区块并不会诞生新的货币，因此执行节点验证者不称为矿工，改称锻工，但他们仍然可拿到交易手续费作为奖励。后来版本的 POS 则亦有出现区块挖矿奖励的设计，尤其若要将 POS 应用在公有链上的话。[8]</p>
<p>而 POS 具体而言如何选出当前区块的写入者？若总是选择权益最高者，则拥有最多货币的成员将永远独占写入权，因此通常实行底下两种方法：</p>
<p><strong>(1) 乱数化的选择方法：</strong><br>产生随机乱数，并以乱数搭配特定公式来选出写入者，唯权益高者仍有较大机率被选中。</p>
<p><strong>(2) 依据货币年龄的选择方法：</strong><br>此方法被用于改善大者恒大的情况，具体可参考 Peercoin 的做法，持有的货币超过 30 天后可加入写入权竞争，将每批货币的数量乘以持有天数加总起来，可得到一个数字，此数字越大则有越高的机率被选为写入者，且一旦获得写入权则此批货币的币龄将被归零，需再持有 30 天才能重新加入计算。唯上述所提的数字有上限值，币龄超过 90 天将无法进一步提高机率，持有大量的货币也可能达到机率最大值。这个方法可有效改善集中化的情形，也大幅增加了攻击的难度。</p>
<p><strong>POS 的优点有：</strong><br>(1) 不须竞争算力，因此低耗能<br>(2) 竞争写入权的成员必定拥有货币，因此相较于破坏，他们宁可选择守护系统，以避免币值蒸发<br>(3) 相较于 POW，同样规模的硬体预算，可保护更多的链上资产</p>
<p><strong>POS 的缺点为：</strong><br>(1) 拥有权益的成员未必希望参与记帐<br>(2) 拿到写入权的坏人若想改写出另一条假链，仅需花费很小的算力，这可能导致 double spending 攻击成功<br>(3) 做坏事的代价很低，没有惩罚机制<br>(4) 基于上述（2）和（3），实行 POS 需要搭配其它机制来改善此种情况，也因此比起 POW 较为复杂</p>
<p><strong>使用 POS 共识算法的数字货币，代表的有 BLK、QTUM 等。</strong>[9]</p>
<h3 id="3-3-DPoS：Delegated-Proof-of-Stake，委托权益证明"><a href="#3-3-DPoS：Delegated-Proof-of-Stake，委托权益证明" class="headerlink" title="3.3 DPoS：Delegated Proof of Stake，委托权益证明"></a>3.3 DPoS：Delegated Proof of Stake，委托权益证明</h3><hr>
<p>POS 的缺点之一为拥有权益的成员未必希望参与记帐，而 DPOS 便可以解决这个问题，类似于民主的代议制度，它先通过权益证明选出记帐参与者（验证节点），再透过运作机制让这些验证节点竞争区块写入权。同时由于验证节点数量大幅缩减的缘故，可快速达成共识。</p>
<p><strong>DPOS 除了具备 POS 的优点以外，还有：</strong><br>(1) 缩小参与验证节点的数量，大幅提高共识速度，这也是 EOS 可以支撑高并发应用的关键原因之一</p>
<p><strong>DPOS 的缺点为：</strong><br>(1) 必须依赖加密货币，然而现今联盟链中许多情况并不存在加密货币<br>(2) 撇除 Casper 的话，多数 DPOS 仍无法有区块最终性</p>
<p><strong>使用 DPOS 共识算法的数字货币，代表的有 BTS、EOS 等。</strong></p>
<h3 id="3-4-PBFT：Practical-Byzantine-Fault-Tolerance，实用拜占庭容错算法"><a href="#3-4-PBFT：Practical-Byzantine-Fault-Tolerance，实用拜占庭容错算法" class="headerlink" title="3.4 PBFT：Practical Byzantine Fault Tolerance，实用拜占庭容错算法"></a>3.4 PBFT：Practical Byzantine Fault Tolerance，实用拜占庭容错算法</h3><hr>
<p>以上共识算法适用于公有链，PBFT 则是一种较适合用于联盟链的共识机制。PBFT 以数学证明模型来验证其取得共识的速度与容错能力，在其容错范围内时可得证系统无法被分叉，上述的 POW 或是 POS 在制度上皆能阻止骇客伪造大量有效益的验证节点，然而原生 PBFT 并无此能力，但若使用在联盟链，则由于联盟链的成员与节点原本就受到筛选与验证，自然地解决了此一问题。</p>
<p>我们再来看下什么是 <strong>公有链、私有链和联盟链</strong>。[10]</p>
<ul>
<li><strong>公有链</strong>：世界上所有人都可以阅读和发送交易。如果他们合法都有希望看到自己被包括在内。世界上任何人都能参与到共识形成过程——决定在链条上添加什么区块以及现状是怎样的。作为中心化或准中心化信任的替代品，公有链受加密经济的保护，加密经济是经济激励和加密图形验证的结合，用类似工作量证明或权益证明的机制，遵循的总原则是人们影响共识形成的程度和他们能够影响的经济资源数量成正比。这类区块链通常被认为是 “完全去中心化”。</li>
<li><strong>联盟链</strong>：共识形成过程由预先选择的一系列的节点所掌控，例如，设想一个有 15 个金融机构的团体，每个机构都操作一个节点，为了使区块生效，其中的 10 个必须签署那个区块。阅读区块链的权利可能是公开的，或仅限于参与者，也有混合的路径，比如区块的根散表和应用程序编程接口一起公开，使公共成员可以进行一定量的查询，重获一部分区块链状态的加密图形证明。这类区块链被认为是 “部分去中心化”。</li>
<li><strong>私人区块链</strong>：书写许可对一个组织保持中心化。阅读许可可能是公开的或者限制在任意程度。应用很可能包含对单个公司内部的数据库管理，审查等，因此公共的可读性在很多情况下根本不必要，但在另一些情况下人们又想要公共可读性。</li>
</ul>
<p><strong>PBFT 的优点有：</strong><br>(1) 系统在容错范围内无法被分叉<br>(2) 系统在容错范围内可容忍任何类型的错误<br>(3) 验证与共识速度极快<br>(4) 不须竞争算力，因此低耗能<br>(5) 基于前述点（1），区块具备最终性</p>
<p><strong>PBFT 的缺点为：</strong><br>(1) 若超过 1／3 的验证节点故障时，则系统无法继续运作<br>(2) 无防范骇客伪造大量验证节点的能力</p>
<h3 id="3-5-PoC：Proof-of-Capacity，容量证明"><a href="#3-5-PoC：Proof-of-Capacity，容量证明" class="headerlink" title="3.5 PoC：Proof-of-Capacity，容量证明"></a>3.5 PoC：Proof-of-Capacity，容量证明</h3><hr>
<p>绝大部分的替代协议都使用了某些类型的付费参与的模式。容量证明也无例外，但是你需要支付的是硬盘空间。你拥有的硬盘容量越多，那么你挖矿下一个区块并获得区块奖励的概率就越大。[11]</p>
<p>在容量证明系统中挖矿之前，该机制会产生大量的 plots 数据，将会存储在你的硬件中。你拥有的 plots 越多，你发现下一个区块的概率就越大。</p>
<p>通过投入大量的硬盘空间，你可以创建复制区块，并分叉系统。因此仍然存在无啊识别 nothing at stake 的问题。</p>
<p>容量证明的变种有高快存储证明和 <a href="https://eprint.iacr.org/2013/796.pdf" target="_blank" rel="noopener">空间证明</a>。</p>
<h3 id="3-6-PoA：Proof-of-activity，活动证明"><a href="#3-6-PoA：Proof-of-activity，活动证明" class="headerlink" title="3.6 PoA：Proof of activity，活动证明"></a>3.6 PoA：Proof of activity，活动证明</h3><hr>
<p>为了避免恶性通货膨胀，比特币最终将只有 2100 个币。这意味着，在某个时间点，比特币区块奖励将会停止，比特币的矿工只能获得交易费。</p>
<p>一些人认为这会导致严重的问题，人们的行为会是利己主义，而且会破坏系统。因此，活动证明（Proof of activity）作为比特币的一种替代激励结构而出现了。活动证明是一种结合了工作量证明和权益证明的混合方法。</p>
<p>在活动证明中，挖矿是以传统的工作量证明形式进行的，矿工互相竞争来解决密码学难题。挖矿产生的区块（它们更像是模板）不包含任何交易，因此获胜的区块只含有头部和矿工奖励地址。</p>
<p>这个时候，系统切换到权益证明。基于头部信息，选择随机的验证者来签名新的区块。验证者拥有的系统种的代币越多，它就越有可能被选择。只要所有的验证者都对其签名，模板就成为成熟的区块。</p>
<p>如果被选中的某些验证者没有完成区块，那么就会选择下一个获胜的区块，然后选择一群新的验证者，以此类推，直到区块获得正确数量的签名。交易费分发给了矿工和所有签名区块的验证者。</p>
<p>活动证明的弊端在于既存在工作量证明的弊端（需要很多的能量来挖矿区块），也存在权益证明的弊端（无法检测双重签名的验证者）。</p>
<p><strong>Decred 是目前唯一使用活动证明的币种。</strong></p>
<h3 id="3-7-PoB：Proof-of-burn，销毁证明"><a href="#3-7-PoB：Proof-of-burn，销毁证明" class="headerlink" title="3.7 PoB：Proof of burn，销毁证明"></a>3.7 PoB：Proof of burn，销毁证明</h3><hr>
<p>在销毁证明中，不需要昂贵的计算设备，而是通过将币发送至一个地址来销毁它们，而且这是不可复原的。通过将你的币发送至想象中的地址，根据随机选择过程你获得了在系统中进行永久挖矿的权利。</p>
<p>根据销毁证明实施的不同，矿工可能会销毁原生代币或其它链的代币，例如比特币。你销毁的币越多，你获得挖矿下一个区块链的机会就越大。</p>
<p>随着时间的进行，你在系统中的股份会降低，因此最终你将会销毁更多的币来增加你挖矿区块的概率。（这有点类似比特币的挖矿过程，你需要持续不断地投入更先进的算力设备来维持算力。）</p>
<p>尽管销毁证明是一个有趣的替代方案，但它仍然需要浪费能源。另外一个问题是，算力流向了那些愿意销毁更多资金的人。</p>
<h3 id="3-8-PoET：Proof-of-elapsed-time，运行时间证明"><a href="#3-8-PoET：Proof-of-elapsed-time，运行时间证明" class="headerlink" title="3.8 PoET：Proof of elapsed time，运行时间证明"></a>3.8 PoET：Proof of elapsed time，运行时间证明</h3><hr>
<p>芯片制造商因特尔发布了自己的共识协议运行时间证明。该系统的工作原理类似于工作量证明系统，但能量消耗很少。而且，参与者无需解决密码学难题，相反该机制使用了可信执行环境（TEE） – 例如 SGX – 来确保区块是以随机方式产生的，但是无需工作量。</p>
<p>因特尔的方法是基于 TEE 提供的保证等待时间的。根据因特尔的说法，该机制可以扩展至上千个节点，而且可以有效地运行在任何支持 SGX 的因特尔处理器中。</p>
<h3 id="3-9-Casper：Ethereum-提出"><a href="#3-9-Casper：Ethereum-提出" class="headerlink" title="3.9 Casper：Ethereum 提出"></a>3.9 Casper：Ethereum 提出</h3><hr>
<p>Ethereum 为了解决上述 POS 共识中做坏事代价很低的缺点，提出的做法为要求有意参与验证节点者缴纳保证金（加密货币）才能参加，而如果验证节点违反规则参与了作假或攻击，甚至仅只是做了系统认为 “无效” 的事，则保证金将会被没收，这个共识机制则称为 Casper，Ethereum 宣称在未来某个适当的时机点将采用 Casper 作为共识算法。Casper 并不是单纯的 DPOS，实际上还参考了 PBFT 的机制来做改良。</p>
<p>单纯的 DPOS 和 POS 一样，会有分叉存在，无法有最终性，而 Casper 透过改良机制使区块的最终性获得保障，如果真的发生攻击使得两个同样高度的区块都被最终确认的话，则存在至少三分之一的验证节点违反了规则，这些节点的保证金将被没收，价值可能高达数千万美金，而由于这些加密货币从市场上消失的缘故，将导致货币的价格上升，这可能取代以往启用紧急硬分叉来修正攻击的手段。</p>
<h2 id="0x04-传统分布式系统共识算法"><a href="#0x04-传统分布式系统共识算法" class="headerlink" title="0x04 传统分布式系统共识算法"></a>0x04 传统分布式系统共识算法</h2><hr>
<ul>
<li>Paxos</li>
<li>Raft</li>
<li>Zab</li>
</ul>
<h3 id="4-1-Paxos"><a href="#4-1-Paxos" class="headerlink" title="4.1 Paxos"></a>4.1 Paxos</h3><hr>
<p>Paxos 是一种 <strong>基于消息传递且具有高度容错特性的一致性算法</strong>。[12] 1990 年由 Leslie Lamport 提出的 Paxos 共识算法，在工程角度实现了一种最大化保障分布式系统一致性（存在极小的概率无法实现一致）的机制。Paxos 被广泛应用在 Chubby、ZooKeeper 这样的系统中，Leslie Lamport 因此获得了 2013 年度图灵奖。[13]</p>
<p>作为一类协议，<strong>Paxos 中包含 Basic Paxos、Multi-Paxos、Cheap Paxos 和其他的变种</strong>。[14]</p>
<p>算法本身用语言描述极其精简：</p>
<p><strong>phase 1</strong><br>a) proposer 向网络内超过半数的 acceptor 发送 prepare 消息<br>b) acceptor 正常情况下回复 promise 消息<br><strong>phase 2</strong><br>a) 在有足够多 acceptor 回复 promise 消息时，proposer 发送 accept 消息<br>b) 正常情况下 acceptor 回复 accepted 消息</p>
<p>Paxos 被用于分布式系统中典型的例子就是 Zookeeper，他是第一个被证明的共识算法，其原理基于两阶段提交并扩展。</p>
<p><strong>Paxos 算法中将节点分为三种类型：</strong></p>
<ul>
<li>proposer：提出一个提案，等待大家批准为结案。往往是客户端担任该角色</li>
<li>acceptor：负责对提案进行投票。往往是服务端担任该角色</li>
<li>learner：被告知结案结果，并与之统一，不参与投票过程。</li>
</ul>
<p>可能为客户端或服务端基本过程包括 proposer 提出提案，先争取大多数 acceptor 的支持，超过一半支持时，则发送结案结果给所有人进行确认。一个潜在的问题是 proposer 在此过程中出现故障，可以通过超时机制来解决。极为凑巧的情况下，每次新的一轮提案的 proposer 都恰好故障，系统则永远无法达成一致（概率很小）。Paxos 能保证在超过 50% 的正常节点存在时，系统能达成共识。[15]</p>
<h3 id="4-2-Raft"><a href="#4-2-Raft" class="headerlink" title="4.2 Raft"></a>4.2 Raft</h3><hr>
<p>Raft 算法是对 Paxos 算法的一种简单实现。Raft 核心思想很容易理解，如果数个数据库，初始状态一致，只要之后的进行的操作一致，就能保证之后的数据一致。由此 Raft 使用的是 Log 进行同步，并且将服务器分为三中角色：Leader，Follower，Candidate，相互可以互相转换。</p>
<p><strong>其基本过程为：</strong></p>
<ul>
<li>Leader 选举：每个 Candidate 随机经过一定时间都会提出选举方案，最近阶段中得票最多者被选为 Leader</li>
<li>同步 Log：Leader 会找到系统中 Log 最新的记录，并强制所有的 Follower 来刷新到这个记录，这里的 Log 指的是各种事件的发生记录</li>
</ul>
<h3 id="4-3-Zab"><a href="#4-3-Zab" class="headerlink" title="4.3 Zab"></a>4.3 Zab</h3><hr>
<p>Zab 的全称是 Zookeeper atomic broadcast protocol，是 Zookeeper 内部用到的一致性协议。相比 Paxos，Zab 最大的特点是保证强一致性 (strong consistency，或叫线性一致性 linearizable consistency)。</p>
<p>和 Raft 一样，Zab 要求唯一 Leader 参与决议，Zab 可以分解成 discovery、sync、broadcast 三个阶段：</p>
<ul>
<li>discovery: 选举产生 PL(prospective leader)，PL 收集 Follower epoch(cepoch)，根据 Follower 的反馈 PL 产生 newepoch(每次选举产生新 Leader 的同时产生新 epoch，类似 Raft 的 term)</li>
<li>sync: PL 补齐相比 Follower 多数派缺失的状态、之后各 Follower 再补齐相比 PL 缺失的状态，PL 和 Follower 完成状态同步后 PL 变为正式 Leader(established leader)</li>
<li>broadcast: Leader 处理 Client 的写操作，并将状态变更广播至 Follower，Follower 多数派通过之后 Leader 发起将状态变更落地 (deliver/commit)<br>Leader 和 Follower 之间通过心跳判别健康状态，正常情况下 Zab 处在 broadcast 阶段，出现 Leader 宕机、网络隔离等异常情况时 Zab 重新回到 discovery 阶段。</li>
</ul>
<h3 id="4-4-对比"><a href="#4-4-对比" class="headerlink" title="4.4 对比"></a>4.4 对比</h3><hr>
<p>除 Paxos、Raft 和 Zab 外，Viewstamped Replication(简称 VR 也是讨论比较多的一致性协议。这些协议包含很多共同的内容 (Leader、quorum、state machine 等)，因而我们不禁要问：Paxos、Raft、Zab 和 VR 等分布式一致性协议区别到底在哪，还是根本就是一回事？[16]</p>
<p>Paxos、Raft、Zab 和 VR 都是解决一致性问题的协议，Paxos 协议原文倾向于理论，Raft、Zab、VR 倾向于实践，一致性保证程度等的不同也导致这些协议间存在差异。相比 Raft、Zab、VR，Paxos 更纯粹、更接近一致性问题本源，尽管 Paxos 倾向理论，但不代表 Paxos 不能应用于工程。基于 Paxos 的工程实践，须考虑具体需求场景 (如一致性要达到什么程度)，再在 Paxos 原始语意上进行包装。</p>
<h2 id="0x05-小结"><a href="#0x05-小结" class="headerlink" title="0x05 小结"></a>0x05 小结</h2><hr>
<p>本文从传统银行共识概念出发，阐述了分布式系统为什么需要共识机制。接着引出了分布式系统的的基本理论，然后阐述了加密数字货币的共识算法，最后给出了传统分布式系统里的共识算法。共识算法也是一个 <strong>Trade-off</strong> 的机制。</p>
<h2 id="0x06-参考"><a href="#0x06-参考" class="headerlink" title="0x06 参考"></a>0x06 参考</h2><hr>
<ul>
<li>[1] 维基百科 (2017-09-20). 共识机制. Retrieved from <a href="https://goo.gl/KFnuRi" target="_blank" rel="noopener">https://goo.gl/KFnuRi</a>.</li>
<li>[2] bangerlee (2016-03-14). 分布式系统理论基础 - 一致性、2PC 和 3PC. Retrieved from <a href="https://goo.gl/6uzyd5" target="_blank" rel="noopener">https://goo.gl/6uzyd5</a>.</li>
<li>[3] bangerlee (2016-04-04). 分布式系统理论基础 - CAP. Retrieved from <a href="https://goo.gl/P7r5Qh" target="_blank" rel="noopener">https://goo.gl/P7r5Qh</a>.</li>
<li>[4] bangerlee (2016-08-21). 分布式系统理论基础 - 选举、多数派和租约. Retrieved from <a href="https://goo.gl/PnU4T6" target="_blank" rel="noopener">https://goo.gl/PnU4T6</a>.</li>
<li>[5] 李笑来 (2017-06-13). INBlockchain 的开源区块链 ICO 投资原则. Retrieved from <a href="https://goo.gl/8bSyKc" target="_blank" rel="noopener">https://goo.gl/8bSyKc</a>.</li>
<li>[6] 维基百科 (2008-08-01). 拜占庭将军问题. Retrieved from <a href="https://goo.gl/AtZHzW" target="_blank" rel="noopener">https://goo.gl/AtZHzW</a></li>
<li>[7] 维基百科 (2017-09-22). 工作量证明. Retrieved from <a href="https://goo.gl/sqX6Gn" target="_blank" rel="noopener">https://goo.gl/sqX6Gn</a>.</li>
<li>[8] 工研院资通所 高靖钧 丁川伟 陈耀鑫 马金沟 陈泽世 (106-05-09). 区块链简介与技术探讨. Retrieved from <a href="https://goo.gl/9AVp4t" target="_blank" rel="noopener">https://goo.gl/9AVp4t</a>.</li>
<li>[9] Proof-of-Stake (PoS) Coins list. <a href="http://www.poslist.org" target="_blank" rel="noopener">http://www.poslist.org</a></li>
<li>[10] 汪晓明 (2017-12-26). 公有链、联盟链、私有链及网络配置介绍. Retrieved from <a href="https://goo.gl/R7Cro7" target="_blank" rel="noopener">https://goo.gl/R7Cro7</a>.</li>
<li>[11] 区块链财经 (2017-03-05). 区块链共识协议指南. Retrieved from <a href="https://goo.gl/RA7A1m" target="_blank" rel="noopener">https://goo.gl/RA7A1m</a></li>
<li>[12] 维基百科 (2007-08-09). Paxos 算法. Retrieved from <a href="https://goo.gl/QCoKj5" target="_blank" rel="noopener">https://goo.gl/QCoKj5</a>.</li>
<li>[13] yeasy (2017-12-17). Paxos 与 Raft. Retrieved from <a href="https://goo.gl/QNpr5j" target="_blank" rel="noopener">https://goo.gl/QNpr5j</a>.</li>
<li>[14] Draveness (2017-12-18). 分布式一致性与共识算法. Retrieved from <a href="https://goo.gl/5d97Uc" target="_blank" rel="noopener">https://goo.gl/5d97Uc</a>.</li>
<li>[15] jerry81333 (2017-07-04). 区块链共识算法 PBFT（拜占庭容错）、PAXOS、RAFT 简述. Retrieved from <a href="https://goo.gl/azGbks" target="_blank" rel="noopener">https://goo.gl/azGbks</a>.</li>
<li>[16] bangerlee (2016-04-04). 分布式系统理论进阶 - Paxos. Retrieved from <a href="https://goo.gl/6ggDHz" target="_blank" rel="noopener">https://goo.gl/6ggDHz</a></li>
</ul>
<p>「区块链技术指北」同名 <strong>知识星球</strong>，二维码如下，欢迎加入。BTW，<strong>李笑来老师也加入了</strong>。</p>
<p><img src="https://i.imgur.com/pQxlDqF.jpg" alt="区块链技术指北"></p>
<p>「区块链技术指北」相关资讯渠道：</p>
<ul>
<li>「区块链技术指北」同名知识星球，<a href="https://t.xiaomiquan.com/ZRbmaU3" target="_blank" rel="noopener">https://t.xiaomiquan.com/ZRbmaU3</a></li>
<li>官方社区，<a href="https://bbs.chainon.io" target="_blank" rel="noopener">https://bbs.chainon.io</a></li>
<li>Telegram Channel，<a href="https://t.me/BlockchainAge" target="_blank" rel="noopener">https://t.me/BlockchainAge</a></li>
<li>Telegram Group，<a href="https://t.me/bcage" target="_blank" rel="noopener">https://t.me/bcage</a></li>
<li>Twitter，<a href="https://twitter.com/bcageone" target="_blank" rel="noopener">https://twitter.com/bcageone</a></li>
<li>新浪微博，<a href="https://weibo.com/BlockchainAge" target="_blank" rel="noopener">https://weibo.com/BlockchainAge</a></li>
</ul>
<p>同时，本系列文章会在以下渠道同步更新，欢迎关注：</p>
<ul>
<li>「区块链技术指北」同名微信公众号（微信号：BlockchainAge）</li>
<li>个人博客，<a href="https://dbarobin.com" target="_blank" rel="noopener">https://dbarobin.com</a></li>
<li>知乎，<a href="https://zhuanlan.zhihu.com/robinwen" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/robinwen</a></li>
<li>Steemit，<a href="https://steemit.com/@robinwen" target="_blank" rel="noopener">https://steemit.com/@robinwen</a></li>
<li>Medium，<a href="https://medium.com/@robinwan" target="_blank" rel="noopener">https://medium.com/@robinwan</a></li>
<li>掘金，<a href="https://juejin.im/user/5673ccae60b2260ee435f89a/posts" target="_blank" rel="noopener">robinwen@juejin.im</a></li>
<li>币乎，<a href="https://bihu.com/people/12109" target="_blank" rel="noopener">https://bihu.com/people/12109</a></li>
</ul>
<p>原创不易，读者可以通过如下途径打赏，虚拟货币、美元、法币均支持。</p>
<ul>
<li>BTC: 3QboL2k5HfKjKDrEYtQAKubWCjx9CX7i8f</li>
<li>ERC20 Token: 0x8907B2ed72A1E2D283c04613536Fac4270C9F0b3</li>
<li>PayPal: <a href="https://www.paypal.me/robinwen" target="_blank" rel="noopener">https://www.paypal.me/robinwen</a></li>
<li>微信打赏二维码</li>
</ul>
<p><img src="https://i.imgur.com/SzoNl5b.jpg" alt="Wechat"></p>
<p>–EOF–</p>
<p>版权声明：<a href="http://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh" target="_blank" rel="noopener">自由转载-非商用-非衍生-保持署名（创意共享4.0许可证）</a></p>

        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
    <!-- 使用 Gitalk -->
<div id="gitalk-comment">
    <!-- Gitalk 评论框 -->
<div id="gitalk-container"></div>

<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">

<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<script type="text/javascript" src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js"></script>

<script>
    var gitalk = new Gitalk({
            clientID: 'f5d48c610cdf262e4f5c',
            clientSecret: '52171aebeb6b254d1d599a10c411a3855650f4d2',
            repo: 'BlockchainOne.github.io',
            owner: 'BlockchainOne',
            admin: ['dbarobin'],
			id: md5(location.pathname),
            // facebook-like distraction free mode
            distractionFreeMode: false
        })
   gitalk.render('gitalk-container')
</script>

</div>
<style>
    #gitalk-comment {
        background-color: #eee;
        padding: 2pc;
    }
</style>

                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2017/12/31/chainone-wechat-issue-3/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2017/12/24/blockchain-sc-wallet/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>


            <!-- ad start -->
            
            <!-- ad end -->
        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.jpg" alt="ChainONE's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        chainone.org@gmail.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="chainone.org@gmail.com" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2021/01/">一月 2021<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/12/">十二月 2020<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/11/">十一月 2020<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/10/">十月 2020<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/09/">九月 2020<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/08/">八月 2020<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/07/">七月 2020<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/06/">六月 2020<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/05/">五月 2020<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/04/">四月 2020<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/03/">三月 2020<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/02/">二月 2020<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/01/">一月 2020<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/12/">十二月 2019<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/11/">十一月 2019<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/10/">十月 2019<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/09/">九月 2019<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/08/">八月 2019<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/07/">七月 2019<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/06/">六月 2019<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/05/">五月 2019<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/04/">四月 2019<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/03/">三月 2019<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/02/">二月 2019<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/01/">一月 2019<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/12/">十二月 2018<span class="sidebar_archives-count">8</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/11/">十一月 2018<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/10/">十月 2018<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/09/">九月 2018<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/08/">八月 2018<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/07/">七月 2018<span class="sidebar_archives-count">8</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/06/">六月 2018<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/05/">五月 2018<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/04/">四月 2018<span class="sidebar_archives-count">7</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/03/">三月 2018<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/02/">二月 2018<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/01/">一月 2018<span class="sidebar_archives-count">12</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/12/">十二月 2017<span class="sidebar_archives-count">16</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/Blockchain/">Blockchain<span class="sidebar_archives-count">32</span></a></li><li><a class="sidebar_archives-link" href="/categories/EOS/">EOS<span class="sidebar_archives-count">8</span></a></li><li><a class="sidebar_archives-link" href="/categories/WeChat/">WeChat<span class="sidebar_archives-count">158</span></a>
            </ul>
        </li>
        
    

    <!-- Pages  -->
    

    <!-- Article Number  -->
    
        <li>
            <a href="/archives">
                文章总数
                <span class="sidebar-badge">198</span>
            </a>
        </li>
        
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->


<!-- Theme Material -->


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/bcageone" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-twitter">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    

    <!-- Google + -->
    

    <!-- Weibo -->
    
        <a href="https://weibo.com/BlockchainAge" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-weibo">
                <span class="visuallyhidden">Weibo</span>
            </button><!--
     --></a>
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/BlockchainOne" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-github">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    
        <a href="https://zhuanlan.zhihu.com/robinwen" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-zhihu">
                <span class="visuallyhidden">Zhihu</span>
            </button><!--
     --></a>
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
        <a href="https://t.me/chainone" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-telegram">
                <span class="visuallyhidden">Telegram</span>
            </button><!--
     --></a>
    
    
    <!-- V2EX -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;2017&nbsp;-<script type="text/javascript">var fd = new Date();document.write("&nbsp;" + fd.getFullYear() + "&nbsp;");</script>区块链技术指北 | ChainONE 官方博客
            
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","/js/lazyload.min.js?1BcfzuNXqV+ntF6gq+5X3Q==", true)</script>



    <script>lsloader.load("js_js","/js/js.min.js?d+XW6aNuIPgOn1iA7NnB4g==", true)</script>



    <script>lsloader.load("np_js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>







    <!-- Busuanzi -->
    <script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



   <!-- GitTalk -->





<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('<link rel="stylesheet" href="/css/uc.css">');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Import prettify js  -->


    
        <script>lsloader.load("hanabi","/js/hanabi-browser-bundle.js?Pki5+pzkluqu53g+ouMWpA==", true)</script>
    


<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
    
        
        
        HanabiBrowser.start('pre code',false);
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->



<script>
    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.5.2 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

   
                    <!-- Google Ad -->
                </main>
            </div>
        </body>
    
</html>
